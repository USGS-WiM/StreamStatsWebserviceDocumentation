var StreamStats;!function(e){"use strinct";var t=function(){function e(e,t,r){this.$stateProvider=e,this.$urlRouterProvider=t,this.$locationProvider=r,this.$stateProvider.state("main",{url:"/",reloadOnSearch:!0,template:"<ui-view/>",views:{main:{templateUrl:"Views/homeview.html",controller:"StreamStats.Controllers.MainController"},sidebar:{templateUrl:"Views/sidebarview.html",controller:"StreamStats.Controllers.SidebarController"},navbar:{templateUrl:"Views/navigationview.html",controller:"StreamStats.Controllers.NavbarController"}}}),this.$urlRouterProvider.otherwise("/")}return e.$inject=["$stateProvider","$urlRouterProvider","$locationProvider"],e}();angular.module("StreamStats",["ui.router","mobile-angular-ui","leaflet-directive","StreamStats.Services","StreamStats.Models","StreamStats.Controllers","jsonFormatter","wim_angular"]).config(t)}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Models",[])}();var StreamStats;!function(e){var t;!function(e){var t=function(){function e(e){this.uri=e,this.parameters=[]}return e}();e.URI=t}(t=e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Services",[])}();var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);r.prototype=t.prototype,e.prototype=new r},StreamStats;!function(e){var t;!function(e){"use strict";function t(e,t){return new r(e,t)}var r=function(e){function t(t,r){e.call(this,t,configuration.baseurls.services),this.$q=r,this._onResourceChanged=new WiM.Event.Delegate,this._onUriChanged=new WiM.Event.Delegate,this.loadResourceList()}return __extends(t,e),Object.defineProperty(t.prototype,"onResourceChanged",{get:function(){return this._onResourceChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onUriChanged",{get:function(){return this._onUriChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ResourceList",{get:function(){return this._resourceList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SelectedResource",{get:function(){return this._selectedResource},set:function(e){this._selectedResource!=e&&(this._selectedResource=e,this.SelectedUri=null,this._onResourceChanged.raise(this,WiM.Event.EventArgs.Empty))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SelectedUri",{get:function(){return this._selectedUri},set:function(e){this._selectedUri!=e&&(this._selectedUri=e,this._onUriChanged.raise(this,WiM.Event.EventArgs.Empty))},enumerable:!0,configurable:!0}),t.prototype.AddResource=function(e){e.name&&this._resourceList.push(e)},t.prototype.RemoveResource=function(){},t.prototype.getURL=function(e,t){var r=new WiM.Services.Helpers.RequestInfo(e,0,t);return this.Execute(r)},t.prototype.loadResourceList=function(){this._resourceList=configuration.resources},t}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q"],angular.module("StreamStats.Services").factory("StreamStats.Services.ResourceService",t)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Controllers",[])}();var StreamStats;!function(e){var t;!function(t){"use strinct";var r=function(){function e(e,t,r){this.lat=e,this.lng=t,this.zoom=r}return e}(),o=function(){function e(e,t,r,o,n){void 0===n&&(n=void 0),this.name=e,this.url=t,this.type=r,this.visible=o,this.layerOptions=n}return e}(),n=function(){function e(e){this.rcode=e}return e}(),s=function(){function t(t,r,s,a,i){var l=this;this.$filter=r,this.Resource=s,this.mapPoint=null,this.bounds=null,this.center=null,this.layers=null,this.markers=null,this.geojson=null,t.vm=this,this.initMap(),this.selectedUri=new e.Models.URI(""),t.$on("leafletDirectiveMap.click",function(e,t){var r=t.leafletEvent.latlng;l.studyArea.lat=r.lat,l.studyArea.lng=r.lng;for(var o in l.selectedUri.parameters)"xlocation"==l.selectedUri.parameters[o].name&&(l.selectedUri.parameters[o].value=r.lng.toFixed(4)),"ylocation"==l.selectedUri.parameters[o].name&&(l.selectedUri.parameters[o].value=r.lat.toFixed(4))}),t.$on("leafletDirectiveMap.zoomend",function(e,t){console.log("map zoom changed",t.leafletEvent.target._animateToZoom,15),t.leafletEvent.target._animateToZoom>=15?l.cursorStyle="crosshair":l.cursorStyle="hand"}),t.$on("leafletDirectiveMap.load",function(e,t){console.log("map loaded")}),t.$watch(function(){return l.selectedUri.parameters},function(e,t){if("Watershed By Location"==l.selectedUri.id)for(var r in l.selectedUri.parameters)if(l.selectedUri.parameters.hasOwnProperty(r)){if(0==t.length)return console.log("first page load"),l.studyArea=new n(e[0].value),void l.leafletData.getMap().then(function(t){console.log("getting the map for fitbounds");for(var r in configuration.regions){var n=configuration.regions[r];n.RegionID==e[0].value.toUpperCase()&&(console.log("match found",n.RegionID+"_region",n.Bounds),t.fitBounds(n.Bounds),l.layers.overlays[n.RegionID+"_region"]=new o(n.RegionID+" Region",configuration.baseurls.StreamStats+"/arcgis/rest/services/{0}_ss/MapServer".format(n.RegionID.toLowerCase()),"agsDynamic",!0,{opacity:.5}))}});"rcode"==l.selectedUri.parameters[r].name&&e[r].value!=t[r].value&&console.log(e[r].value)}},!0),this.leafletData=i,this.waitCursor=!1,this.sideBarCollapsed=!1,this.applicationURL=configuration.baseurls.application,this.servicesBaseURL=configuration.baseurls.services,this._onSelectedResourceHandler=new WiM.Event.EventHandler(function(){l.selectedResource=s.SelectedResource}),s.onResourceChanged.subscribe(this._onSelectedResourceHandler),this._onSelectedUriHandler=new WiM.Event.EventHandler(function(){l.selectedUri=s.SelectedUri,l.requestResults=""}),s.onUriChanged.subscribe(this._onSelectedUriHandler)}return t.prototype.loadURL=function(){var e=this,t=this.$filter("makeURL")(this.selectedUri);this.waitCursor=!0,this.Resource.getURL(t,this.selectedMedia).then(function(t){e.requestResults=t.data},function(t){e.requestResults="("+t.status+") "+t.data})["finally"](function(){e.waitCursor=!1})},t.prototype.startDelineate=function(e){console.log("in startDelineate"),this.markers.pourpoint={lat:this.studyArea.lat,lng:this.studyArea.lng,message:"new pourpoint",focus:!0},this.loadStudyBoundary()},t.prototype.loadStudyBoundary=function(){var e=this,t=configuration.queryparams.SSdelineation.format(this.studyArea.rcode,this.studyArea.lng.toString(),this.studyArea.lat.toString(),"4326",!1);this.Resource.getURL(t,"JSON").then(function(t){e.studyArea.features=t.data.hasOwnProperty("featurecollection")?t.data.featurecollection:null,e.studyArea.workspaceID=t.data.hasOwnProperty("workspaceID")?t.data.workspaceID:null},function(e){})["finally"](function(){e.onSelectedStudyAreaChanged()})},t.prototype.onSelectedStudyAreaChanged=function(){var e=this;if(console.log("features returned: ",this.studyArea.features),this.studyArea.features){this.studyArea.features.forEach(function(t){e.geojson[t.name]={data:t.feature},"delineatedbasin(simplified)"==t.name?e.geojson[t.name].style={fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}:"pourpoint"==t.name&&(e.geojson[t.name].onEachFeature=function(e,t){var r="";angular.forEach(e.properties,function(e,t){r+="<strong>"+t+": </strong>"+e+"</br>"}),t.bindPopup(r)})}),this.markers={};var t=this.geojson.globalwatershed.data.features[0].bbox;console.log(t),this.leafletData.getMap().then(function(e){e.fitBounds([[t[1],t[0]],[t[3],t[2]]])})}},t.prototype.initMap=function(){this.center=new r(39,-100,4),this.layers={baselayers:configuration.basemaps,overlays:configuration.overlayedLayers,markers:this.markers,geojson:this.geojson},this.markers={},this.geojson={}},t.prototype.removeOverlayLayers=function(e,t){var r=this;void 0===t&&(t=!1);var o;o=this.getLayerIdsByID(e,this.layers.overlays,t),o.forEach(function(e){delete r.layers.overlays[e]})},t.prototype.getLayerIdsByID=function(e,t,r){var o=[];for(var n in t)(r?n.indexOf(e)>-1:n===e)&&o.push(n);return o},t.prototype.sm=function(e){try{}catch(t){}},t.$inject=["$scope","$filter","StreamStats.Services.ResourceService","leafletBoundsHelpers","leafletData"],t}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.MainController",s)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){"use strinct";var t=function(){function e(e,t){var r=this;this.resourceService=t,e.vm=this,this._onSelectedResourceHandler=new WiM.Event.EventHandler(function(){r.selectedResource=r.resourceService.SelectedResource}),this.resourceList=t.ResourceList,t.onResourceChanged.subscribe(this._onSelectedResourceHandler)}return e.prototype.selectResource=function(e){this.resourceService.SelectedResource=e},e.prototype.selectUri=function(e){this.resourceService.SelectedUri=e},e.prototype.sm=function(e){try{}catch(t){}},e.$inject=["$scope","StreamStats.Services.ResourceService"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.SidebarController",t)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){"use strinct";var t,r=function(){function e(e){e.vm=this,this.sideBarCollapsed=!1,this.selectedProcedure=1}return e.prototype.setProcedureType=function(e){this.selectedProcedure!=e&&this.canUpdateProceedure(e)&&(this.selectedProcedure=e)},e.prototype.toggleSideBar=function(){this.sideBarCollapsed?this.sideBarCollapsed=!1:this.sideBarCollapsed=!0},e.prototype.canUpdateProceedure=function(e){try{switch(e){case 1:return!0;case 2:return!0;case 3:return!0;case 4:return!1;case 5:return!1;default:return!1}}catch(t){return!1}},e.prototype.sm=function(e){try{}catch(t){}},e.$inject=["$scope"],e}();!function(e){e[e.INIT=1]="INIT",e[e.IDENTIFY=2]="IDENTIFY",e[e.SELECT=3]="SELECT",e[e.REFINE=4]="REFINE",e[e.BUILD=5]="BUILD"}(t||(t={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NavbarController",r)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),angular.module("StreamStats").filter("makeURL",function(){return function(e){if(e.uri){console.log("in makeURL filter");for(var t=[e.selectedMedia],r=0;r<e.parameters.length;r++)t.push(e.parameters[r].value);var o=e.uri.format,n=o.apply(e.uri,t);return e.newURL=n,n.replace(/\{(.+?)\}/g,"")}}}),function(){"use strict";angular.module("StreamStats.Controllers",[])}();var StreamStats;!function(e){var t;!function(t){"use strinct";var r=function(){function e(e,t,r){this.lat=e,this.lng=t,this.zoom=r}return e}(),o=function(){function e(e,t,r,o,n){void 0===n&&(n=void 0),this.name=e,this.url=t,this.type=r,this.visible=o,this.layerOptions=n}return e}(),n=function(){function e(e){this.rcode=e}return e}(),s=function(){function t(t,r,s,a,i){var l=this;this.$filter=r,this.Resource=s,this.mapPoint=null,this.bounds=null,this.center=null,this.layers=null,this.markers=null,this.geojson=null,t.vm=this,this.initMap(),this.selectedUri=new e.Models.URI(""),t.$on("leafletDirectiveMap.click",function(e,t){var r=t.leafletEvent.latlng;l.studyArea.lat=r.lat,l.studyArea.lng=r.lng;for(var o in l.selectedUri.parameters)"xlocation"==l.selectedUri.parameters[o].name&&(l.selectedUri.parameters[o].value=r.lng.toFixed(4)),"ylocation"==l.selectedUri.parameters[o].name&&(l.selectedUri.parameters[o].value=r.lat.toFixed(4))}),t.$on("leafletDirectiveMap.zoomend",function(e,t){console.log("map zoom changed",t.leafletEvent.target._animateToZoom,15),t.leafletEvent.target._animateToZoom>=15?l.cursorStyle="crosshair":l.cursorStyle="hand"}),t.$on("leafletDirectiveMap.load",function(e,t){console.log("map loaded")}),t.$watch(function(){return l.selectedUri.parameters},function(e,t){if("Watershed By Location"==l.selectedUri.id)for(var r in l.selectedUri.parameters)if(l.selectedUri.parameters.hasOwnProperty(r)){if(0==t.length)return console.log("first page load"),l.studyArea=new n(e[0].value),void l.leafletData.getMap().then(function(t){console.log("getting the map for fitbounds");for(var r in configuration.regions){var n=configuration.regions[r];n.RegionID==e[0].value.toUpperCase()&&(console.log("match found",n.RegionID+"_region",n.Bounds),t.fitBounds(n.Bounds),l.layers.overlays[n.RegionID+"_region"]=new o(n.RegionID+" Region",configuration.baseurls.StreamStats+"/arcgis/rest/services/{0}_ss/MapServer".format(n.RegionID.toLowerCase()),"agsDynamic",!0,{opacity:.5}))}});"rcode"==l.selectedUri.parameters[r].name&&e[r].value!=t[r].value&&console.log(e[r].value)}},!0),this.leafletData=i,this.waitCursor=!1,this.sideBarCollapsed=!1,this.applicationURL=configuration.baseurls.application,this.servicesBaseURL=configuration.baseurls.services,this._onSelectedResourceHandler=new WiM.Event.EventHandler(function(){l.selectedResource=s.SelectedResource}),s.onResourceChanged.subscribe(this._onSelectedResourceHandler),this._onSelectedUriHandler=new WiM.Event.EventHandler(function(){l.selectedUri=s.SelectedUri,l.requestResults=""}),s.onUriChanged.subscribe(this._onSelectedUriHandler)}return t.prototype.loadURL=function(){var e=this,t=this.$filter("makeURL")(this.selectedUri);this.waitCursor=!0,this.Resource.getURL(t,this.selectedMedia).then(function(t){e.requestResults=t.data},function(t){e.requestResults="("+t.status+") "+t.data})["finally"](function(){e.waitCursor=!1})},t.prototype.startDelineate=function(e){console.log("in startDelineate"),this.markers.pourpoint={lat:this.studyArea.lat,lng:this.studyArea.lng,message:"new pourpoint",focus:!0},this.loadStudyBoundary()},t.prototype.loadStudyBoundary=function(){var e=this,t=configuration.queryparams.SSdelineation.format(this.studyArea.rcode,this.studyArea.lng.toString(),this.studyArea.lat.toString(),"4326",!1);this.Resource.getURL(t,"JSON").then(function(t){e.studyArea.features=t.data.hasOwnProperty("featurecollection")?t.data.featurecollection:null,e.studyArea.workspaceID=t.data.hasOwnProperty("workspaceID")?t.data.workspaceID:null},function(e){})["finally"](function(){e.onSelectedStudyAreaChanged()})},t.prototype.onSelectedStudyAreaChanged=function(){var e=this;if(console.log("features returned: ",this.studyArea.features),this.studyArea.features){this.studyArea.features.forEach(function(t){e.geojson[t.name]={data:t.feature},"delineatedbasin(simplified)"==t.name?e.geojson[t.name].style={fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}:"pourpoint"==t.name&&(e.geojson[t.name].onEachFeature=function(e,t){var r="";angular.forEach(e.properties,function(e,t){r+="<strong>"+t+": </strong>"+e+"</br>"}),t.bindPopup(r)})}),this.markers={};var t=this.geojson.globalwatershed.data.features[0].bbox;console.log(t),this.leafletData.getMap().then(function(e){e.fitBounds([[t[1],t[0]],[t[3],t[2]]])})}},t.prototype.initMap=function(){this.center=new r(39,-100,4),this.layers={baselayers:configuration.basemaps,overlays:configuration.overlayedLayers,markers:this.markers,geojson:this.geojson},this.markers={},this.geojson={}},t.prototype.removeOverlayLayers=function(e,t){var r=this;void 0===t&&(t=!1);var o;o=this.getLayerIdsByID(e,this.layers.overlays,t),o.forEach(function(e){delete r.layers.overlays[e]})},t.prototype.getLayerIdsByID=function(e,t,r){var o=[];for(var n in t)(r?n.indexOf(e)>-1:n===e)&&o.push(n);return o},t.prototype.sm=function(e){try{}catch(t){}},t.$inject=["$scope","$filter","StreamStats.Services.ResourceService","leafletBoundsHelpers","leafletData"],t}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.MainController",s)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){"use strinct";var t=function(){function e(e,t){var r=this;this.resourceService=t,e.vm=this,this._onSelectedResourceHandler=new WiM.Event.EventHandler(function(){r.selectedResource=r.resourceService.SelectedResource}),this.resourceList=t.ResourceList,t.onResourceChanged.subscribe(this._onSelectedResourceHandler)}return e.prototype.selectResource=function(e){this.resourceService.SelectedResource=e},e.prototype.selectUri=function(e){this.resourceService.SelectedUri=e},e.prototype.sm=function(e){try{}catch(t){}},e.$inject=["$scope","StreamStats.Services.ResourceService"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.SidebarController",t)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){"use strinct";var t,r=function(){function e(e){e.vm=this,this.sideBarCollapsed=!1,this.selectedProcedure=1}return e.prototype.setProcedureType=function(e){this.selectedProcedure!=e&&this.canUpdateProceedure(e)&&(this.selectedProcedure=e)},e.prototype.toggleSideBar=function(){this.sideBarCollapsed?this.sideBarCollapsed=!1:this.sideBarCollapsed=!0},e.prototype.canUpdateProceedure=function(e){try{switch(e){case 1:return!0;case 2:return!0;case 3:return!0;case 4:return!1;case 5:return!1;default:return!1}}catch(t){return!1}},e.prototype.sm=function(e){try{}catch(t){}},e.$inject=["$scope"],e}();!function(e){e[e.INIT=1]="INIT",e[e.IDENTIFY=2]="IDENTIFY",e[e.SELECT=3]="SELECT",e[e.REFINE=4]="REFINE",e[e.BUILD=5]="BUILD"}(t||(t={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NavbarController",r)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));